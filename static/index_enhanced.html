<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Oudience AI Assistant</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

<style>
  :root{
    --primary: #2563eb;
    --primary-dark: #1d4ed8;
    --secondary: #64748b;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --bg-light: #f8fafc;
    --bg-white: #ffffff;
    --bg-dark: #0f172a;
    --card-dark: #1e293b;
    --text-light: #1e293b;
    --text-dark: #f1f5f9;
    --border-light: #e2e8f0;
    --border-dark: #334155;
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
  }

  body.dark {
    --bg-light: var(--bg-dark);
    --bg-white: var(--card-dark);
    --text-light: var(--text-dark);
    --border-light: var(--border-dark);
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html, body {
    height: 100%;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg-light);
    color: var(--text-light);
    transition: all 0.3s ease;
  }

  .app {
    display: flex;
    flex-direction: column;
    height: 100vh;
    max-width: 1200px;
    margin: 0 auto;
    background: var(--bg-white);
    box-shadow: var(--shadow-lg);
  }

  /* Header */
  .header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 1rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: var(--shadow);
  }

  .header h1 {
    font-size: 1.5rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .header-controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .btn-icon {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    font-size: 1.1rem;
  }

  .btn-icon:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-1px);
  }

  /* Chat Area */
  .chat-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    scroll-behavior: smooth;
  }

  .message {
    max-width: 80%;
    padding: 1rem 1.25rem;
    border-radius: 1rem;
    line-height: 1.6;
    position: relative;
    animation: slideIn 0.3s ease-out;
    white-space: pre-wrap;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .message.user {
    align-self: flex-end;
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    border-bottom-right-radius: 0.25rem;
  }

  .message.bot {
    align-self: flex-start;
    background: var(--bg-light);
    border: 1px solid var(--border-light);
    border-bottom-left-radius: 0.25rem;
    position: relative;
  }

  .message.bot::before {
    content: '';
    position: absolute;
    left: -0.5rem;
    top: 1rem;
    width: 0;
    height: 0;
    border-top: 8px solid transparent;
    border-bottom: 8px solid transparent;
    border-right: 8px solid var(--bg-light);
  }

  .message-time {
    font-size: 0.75rem;
    opacity: 0.7;
    margin-top: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .typing-indicator {
    display: none;
    align-self: flex-start;
    background: var(--bg-light);
    border: 1px solid var(--border-light);
    padding: 1rem 1.25rem;
    border-radius: 1rem;
    border-bottom-left-radius: 0.25rem;
  }

  .typing-dots {
    display: flex;
    gap: 0.25rem;
  }

  .typing-dots span {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--secondary);
    animation: typing 1.4s infinite ease-in-out;
  }

  .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
  .typing-dots span:nth-child(2) { animation-delay: -0.16s; }

  @keyframes typing {
    0%, 80%, 100% {
      transform: scale(0);
      opacity: 0.5;
    }
    40% {
      transform: scale(1);
      opacity: 1;
    }
  }

  /* Input Area */
  .input-container {
    padding: 1.5rem;
    background: var(--bg-white);
    border-top: 1px solid var(--border-light);
  }

  .input-wrapper {
    display: flex;
    gap: 0.75rem;
    align-items: flex-end;
    max-width: 100%;
  }

  .input-field {
    flex: 1;
    min-height: 48px;
    max-height: 120px;
    padding: 0.75rem 1rem;
    border: 2px solid var(--border-light);
    border-radius: 12px;
    font-size: 1rem;
    font-family: inherit;
    background: var(--bg-white);
    color: var(--text-light);
    resize: none;
    transition: all 0.2s ease;
    outline: none;
  }

  .input-field:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
  }

  .send-btn {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    border: none;
    width: 48px;
    height: 48px;
    border-radius: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    font-size: 1.1rem;
  }

  .upload-btn {
    background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
    color: white;
    border: none;
    width: 48px;
    height: 48px;
    border-radius: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    font-size: 1.1rem;
  }

  .send-btn:hover:not(:disabled), .upload-btn:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: var(--shadow);
  }

  .send-btn:disabled, .upload-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .upload-btn:hover:not(:disabled) {
    background: linear-gradient(135deg, #059669 0%, #047857 100%);
  }

  /* Status Bar */
  .status-bar {
    padding: 0.5rem 1.5rem;
    background: var(--bg-light);
    border-top: 1px solid var(--border-light);
    font-size: 0.875rem;
    color: var(--secondary);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .status-indicator {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--success);
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
  }

  /* Welcome Message */
  .welcome-message {
    text-align: center;
    padding: 2rem;
    color: var(--secondary);
  }

  .welcome-message i {
    font-size: 3rem;
    margin-bottom: 1rem;
    color: var(--primary);
  }

  .welcome-message h2 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    color: var(--text-light);
  }

  .welcome-message p {
    font-size: 1rem;
    line-height: 1.6;
    margin-bottom: 1.5rem;
  }

  /* Example Questions */
  .example-questions {
    margin-top: 1.5rem;
    text-align: left;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  .example-questions h3 {
    font-size: 0.875rem;
    color: var(--secondary);
    margin-bottom: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .example-category {
    margin-bottom: 1rem;
  }

  .example-category-title {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-light);
    margin-bottom: 0.5rem;
  }

  .example-btn {
    display: block;
    width: 100%;
    text-align: left;
    padding: 0.75rem 1rem;
    margin-bottom: 0.5rem;
    background: var(--bg-white);
    border: 1px solid var(--border-light);
    border-radius: 8px;
    color: var(--text-light);
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.875rem;
  }

  .example-btn:hover {
    background: var(--bg-light);
    border-color: var(--primary);
    transform: translateX(4px);
  }

  /* System Info Banner */
  .system-info {
    background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
    border: 1px solid #bfdbfe;
    border-radius: 8px;
    padding: 0.75rem 1rem;
    margin: 1rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.875rem;
    color: #1e40af;
  }

  .system-info i {
    font-size: 1.25rem;
  }

  /* Upload Progress */
  .upload-progress {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--bg-white);
    border: 1px solid var(--border-light);
    border-radius: 12px;
    padding: 2rem;
    box-shadow: var(--shadow-lg);
    z-index: 1000;
    min-width: 300px;
    text-align: center;
  }

  .upload-progress h3 {
    margin-bottom: 1rem;
    color: var(--text-light);
  }

  .progress-bar {
    width: 100%;
    height: 8px;
    background: var(--bg-light);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 1rem;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
    width: 0%;
    transition: width 0.3s ease;
  }

  .upload-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 999;
  }

  /* Notification */
  .notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: var(--bg-white);
    border: 1px solid var(--border-light);
    border-radius: 8px;
    padding: 1rem 1.5rem;
    box-shadow: var(--shadow-lg);
    z-index: 1001;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    max-width: 400px;
    animation: slideInRight 0.3s ease-out;
  }

  @keyframes slideInRight {
    from {
      opacity: 0;
      transform: translateX(100%);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes slideOut {
    from {
      opacity: 1;
      transform: translateX(0);
    }
    to {
      opacity: 0;
      transform: translateX(-100%);
    }
  }

  .notification.success {
    border-left: 4px solid var(--success);
  }

  .notification.error {
    border-left: 4px solid var(--danger);
  }

  .notification.warning {
    border-left: 4px solid var(--warning);
  }

  /* Enhanced Upload Area - Significantly Improved */
  .upload-area {
    background: linear-gradient(135deg, 
      rgba(37, 99, 235, 0.05) 0%, 
      rgba(16, 185, 129, 0.05) 50%, 
      rgba(37, 99, 235, 0.05) 100%);
    border: 3px dashed var(--border-light);
    border-radius: 20px;
    padding: 3rem 2rem;
    margin-bottom: 1.5rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    min-height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .upload-area::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
      transparent, 
      rgba(37, 99, 235, 0.1), 
      transparent);
    transition: left 0.6s ease;
  }

  .upload-area:hover::before {
    left: 100%;
  }

  .upload-area:hover {
    border-color: var(--primary);
    background: linear-gradient(135deg, 
      rgba(37, 99, 235, 0.1) 0%, 
      rgba(16, 185, 129, 0.1) 50%, 
      rgba(37, 99, 235, 0.1) 100%);
    transform: translateY(-4px);
    box-shadow: 0 20px 40px rgba(37, 99, 235, 0.15);
  }

  .upload-area.dragover {
    border-color: var(--success);
    background: linear-gradient(135deg, 
      rgba(16, 185, 129, 0.15) 0%, 
      rgba(37, 99, 235, 0.15) 50%, 
      rgba(16, 185, 129, 0.15) 100%);
    transform: scale(1.02);
    box-shadow: 0 25px 50px rgba(16, 185, 129, 0.2);
  }

  .upload-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
    z-index: 2;
    position: relative;
  }

  .upload-icon-container {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .upload-icon {
    font-size: 4rem;
    color: var(--primary);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    filter: drop-shadow(0 4px 8px rgba(37, 99, 235, 0.2));
  }

  .upload-pulse {
    position: absolute;
    width: 80px;
    height: 80px;
    border: 2px solid var(--primary);
    border-radius: 50%;
    opacity: 0;
    animation: pulse-ring 2s infinite;
  }

  @keyframes pulse-ring {
    0% {
      transform: scale(0.8);
      opacity: 1;
    }
    100% {
      transform: scale(2);
      opacity: 0;
    }
  }

  .upload-area:hover .upload-icon {
    color: var(--primary-dark);
    transform: scale(1.1) rotate(5deg);
  }

  .upload-area:hover .upload-pulse {
    animation-duration: 1s;
  }

  .upload-text {
    max-width: 500px;
  }

  .upload-text h3 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-light);
    margin-bottom: 0.75rem;
    line-height: 1.3;
  }

  .upload-subtitle {
    font-size: 1.1rem;
    color: var(--secondary);
    margin-bottom: 1.5rem;
    line-height: 1.5;
    font-weight: 500;
  }

  .upload-features {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }

  .feature-tag {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    transition: all 0.3s ease;
  }

  .feature-tag:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(37, 99, 235, 0.4);
  }

  .upload-hint {
    color: var(--secondary);
    font-size: 0.95rem;
    font-weight: 500;
    opacity: 0.8;
  }

  .upload-background-pattern {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    opacity: 0.03;
    background-image: 
      radial-gradient(circle at 25% 25%, var(--primary) 2px, transparent 2px),
      radial-gradient(circle at 75% 75%, var(--success) 2px, transparent 2px);
    background-size: 50px 50px;
    background-position: 0 0, 25px 25px;
    z-index: 1;
  }

  /* PDF Management */
  .pdf-management {
    background: var(--bg-white);
    border: 1px solid var(--border-light);
    border-radius: 12px;
    margin-bottom: 1rem;
    max-height: 400px;
    overflow: hidden;
    box-shadow: var(--shadow);
  }

  .pdf-management-header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 1rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .pdf-management-header h3 {
    font-size: 1.1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin: 0;
  }

  .pdf-list {
    max-height: 320px;
    overflow-y: auto;
    padding: 1rem;
  }

  .pdf-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    border: 1px solid var(--border-light);
    border-radius: 8px;
    margin-bottom: 0.75rem;
    background: var(--bg-white);
    transition: all 0.2s ease;
  }

  .pdf-item:hover {
    background: var(--bg-light);
    border-color: var(--primary);
    transform: translateX(4px);
  }

  .pdf-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .pdf-name {
    font-weight: 600;
    color: var(--text-light);
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .pdf-name i {
    color: var(--danger);
    font-size: 1.1rem;
  }

  .pdf-details {
    font-size: 0.875rem;
    color: var(--secondary);
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .pdf-actions {
    display: flex;
    gap: 0.5rem;
  }

  .delete-btn {
    background: var(--danger);
    color: white;
    border: none;
    width: 36px;
    height: 36px;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    font-size: 0.9rem;
  }

  .delete-btn:hover {
    background: #dc2626;
    transform: scale(1.05);
  }

  .loading-spinner {
    text-align: center;
    padding: 2rem;
    color: var(--secondary);
  }

  .loading-spinner i {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
  }

  .empty-state {
    text-align: center;
    padding: 2rem;
    color: var(--secondary);
  }

  .empty-state i {
    font-size: 3rem;
    margin-bottom: 1rem;
    color: var(--primary);
    opacity: 0.5;
  }

  .manage-btn {
    background: linear-gradient(135deg, var(--secondary) 0%, #475569 100%);
    color: white;
    border: none;
    width: 48px;
    height: 48px;
    border-radius: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    font-size: 1.1rem;
  }

  .manage-btn:hover:not(:disabled) {
    background: linear-gradient(135deg, #475569 0%, #334155 100%);
    transform: translateY(-1px);
    box-shadow: var(--shadow);
  }

  .manage-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* Confirmation Dialog */
  .confirm-dialog {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--bg-white);
    border: 1px solid var(--border-light);
    border-radius: 12px;
    padding: 2rem;
    box-shadow: var(--shadow-lg);
    z-index: 1002;
    min-width: 400px;
    text-align: center;
  }

  .confirm-dialog h3 {
    color: var(--text-light);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }

  .confirm-dialog p {
    color: var(--secondary);
    margin-bottom: 1.5rem;
    line-height: 1.5;
  }

  .confirm-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
  }

  .confirm-btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.2s ease;
  }

  .confirm-btn.danger {
    background: var(--danger);
    color: white;
  }

  .confirm-btn.danger:hover {
    background: #dc2626;
  }

  .confirm-btn.secondary {
    background: var(--bg-light);
    color: var(--text-light);
    border: 1px solid var(--border-light);
  }

  .confirm-btn.secondary:hover {
    background: var(--border-light);
  }

  .confirm-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1001;
  }
  @media (max-width: 768px) {
    .app {
      height: 100vh;
      max-width: 100%;
    }
    
    .header {
      padding: 1rem;
    }
    
    .header h1 {
      font-size: 1.25rem;
    }
    
    .message {
      max-width: 90%;
    }
    
    .chat-messages {
      padding: 1rem;
    }
    
    .input-container {
      padding: 1rem;
    }

    .example-questions {
      padding: 0 1rem;
    }

    .upload-area {
      padding: 2rem 1.5rem;
      min-height: 180px;
    }

    .upload-icon {
      font-size: 3rem;
    }

    .upload-text h3 {
      font-size: 1.3rem;
    }

    .upload-subtitle {
      font-size: 1rem;
    }

    .upload-features {
      flex-direction: column;
      gap: 0.75rem;
    }

    .feature-tag {
      font-size: 0.8rem;
      padding: 0.4rem 0.8rem;
    }

    .pdf-management {
      max-height: 300px;
    }

    .pdf-item {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.75rem;
    }

    .pdf-details {
      flex-direction: column;
      gap: 0.25rem;
    }

    .pdf-actions {
      align-self: flex-end;
    }

    .confirm-dialog {
      min-width: 300px;
      margin: 1rem;
    }

    .input-wrapper {
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .manage-btn, .upload-btn {
      width: 44px;
      height: 44px;
    }
  }
</style>
</head>

<body>

<div class="app">
  <header class="header">
    <h1>
      <i class="fas fa-graduation-cap"></i>
      Student Learning Assistant
    </h1>
    <div class="header-controls">
      <button onclick="showHelp()" class="btn-icon" title="Help & Examples">
        <i class="fas fa-question-circle"></i>
      </button>
      <button onclick="clearChat()" class="btn-icon" title="Clear Chat">
        <i class="fas fa-trash"></i>
      </button>
      <button onclick="toggleDark()" class="btn-icon" title="Toggle Theme">
        <i class="fas fa-moon"></i>
      </button>
    </div>
  </header>

  <div class="chat-container">
    <div id="chatMessages" class="chat-messages">
      <div class="welcome-message">
        <i class="fas fa-book-open"></i>
        <h2>Welcome to Your Student Learning Assistant</h2>
        <p>I'm here to help you understand your study materials! Upload PDFs (textbooks, notes, research papers) using the <i class="fas fa-upload"></i> button below, then ask me questions. I'll explain concepts in simple language and show you exactly where the information comes from.</p>
        
        <div class="example-questions" id="exampleQuestions">
          <h3>üí° Try asking:</h3>
          <!-- Examples will be loaded here -->
        </div>
      </div>
    </div>

    <div class="typing-indicator" id="typingIndicator">
      <div class="typing-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>

  <div class="input-container">
    <!-- PDF Management Section -->
    <div id="pdfManagement" class="pdf-management" style="display: none;">
      <div class="pdf-management-header">
        <h3><i class="fas fa-file-pdf"></i> Your Study Materials</h3>
        <button id="closePdfManager" class="btn-icon">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div id="pdfList" class="pdf-list">
        <div class="loading-spinner">
          <i class="fas fa-spinner fa-spin"></i> Loading your files...
        </div>
      </div>
    </div>

    <!-- Enhanced Upload Area -->
    <div class="upload-area" id="uploadArea">
      <div class="upload-content">
        <div class="upload-icon-container">
          <i class="fas fa-cloud-upload-alt upload-icon"></i>
          <div class="upload-pulse"></div>
        </div>
        <div class="upload-text">
          <h3>üìÑ Upload your PDF study material here</h3>
          <p class="upload-subtitle">Ask questions directly from your uploaded book or notes</p>
          <div class="upload-features">
            <span class="feature-tag"><i class="fas fa-file-pdf"></i> PDF Files</span>
            <span class="feature-tag"><i class="fas fa-weight-hanging"></i> Up to 10MB</span>
            <span class="feature-tag"><i class="fas fa-magic"></i> Instant Processing</span>
          </div>
          <p class="upload-hint">Drop your files here or click to browse</p>
        </div>
      </div>
      <div class="upload-background-pattern"></div>
    </div>

    <div class="input-wrapper">
      <button id="manageBtn" class="manage-btn" title="Manage Study Materials">
        <i class="fas fa-folder-open"></i>
      </button>
      <button id="uploadBtn" class="upload-btn" title="Upload Study Materials">
        <i class="fas fa-upload"></i>
      </button>
      <textarea 
        id="messageInput" 
        class="input-field" 
        placeholder="Ask me about your study materials..."
        rows="1"
      ></textarea>
      <button id="sendBtn" class="send-btn" title="Send Message">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
    <input type="file" id="fileInput" accept=".pdf" multiple style="display: none;">
  </div>

  <div class="status-bar">
    <div class="status-indicator">
      <div class="status-dot" id="statusDot"></div>
      <span id="statusText">Connecting...</span>
    </div>
    <div id="messageCount">0 messages</div>
  </div>
</div>

<script>
const messageInput = document.getElementById("messageInput");
const chatMessages = document.getElementById("chatMessages");
const sendBtn = document.getElementById("sendBtn");
const uploadBtn = document.getElementById("uploadBtn");
const manageBtn = document.getElementById("manageBtn");
const fileInput = document.getElementById("fileInput");
const uploadArea = document.getElementById("uploadArea");
const pdfManagement = document.getElementById("pdfManagement");
const closePdfManager = document.getElementById("closePdfManager");
const pdfList = document.getElementById("pdfList");
const typingIndicator = document.getElementById("typingIndicator");
const messageCount = document.getElementById("messageCount");
const statusText = document.getElementById("statusText");
const statusDot = document.getElementById("statusDot");

let messageCounter = 0;
let systemInfo = null;

// Load system info and examples
async function loadSystemInfo() {
  try {
    const response = await fetch("/api/system-info");
    systemInfo = await response.json();
    
    if (systemInfo.status === "online") {
      if (systemInfo.total_documents > 0) {
        statusText.textContent = `Learning Assistant Online ‚Ä¢ ${systemInfo.total_documents} study materials loaded`;
        statusDot.style.background = "var(--success)";
      } else {
        statusText.textContent = "Learning Assistant Online ‚Ä¢ No study materials uploaded yet";
        statusDot.style.background = "var(--warning)";
        
        // Show upload reminder if no materials
        showUploadReminder();
      }
    }
  } catch (error) {
    statusText.textContent = "Connection Error";
    statusDot.style.background = "var(--danger)";
  }
}

function showUploadReminder() {
  const reminder = document.createElement('div');
  reminder.className = 'system-info';
  reminder.innerHTML = `
    <i class="fas fa-info-circle"></i>
    <div>
      <strong>Get Started:</strong> Upload your first PDF study material using the 
      <i class="fas fa-upload" style="color: var(--success);"></i> button below to start learning!
    </div>
  `;
  
  const welcomeMsg = chatMessages.querySelector('.welcome-message');
  if (welcomeMsg) {
    welcomeMsg.appendChild(reminder);
  }
}

async function loadExamples() {
  try {
    const response = await fetch("/api/example-questions");
    const examples = await response.json();
    
    const container = document.getElementById("exampleQuestions");
    let html = '<h3>üí° Try asking:</h3>';
    
    examples.forEach(category => {
      html += `<div class="example-category">`;
      html += `<div class="example-category-title">${category.category}</div>`;
      category.questions.forEach(q => {
        html += `<button class="example-btn" onclick="askQuestion('${q.replace(/'/g, "\\'")}')">${q}</button>`;
      });
      html += `</div>`;
    });
    
    container.innerHTML = html;
  } catch (error) {
    console.error("Failed to load examples:", error);
  }
}

function askQuestion(question) {
  messageInput.value = question;
  sendMessage();
}

function showHelp() {
  const welcomeMsg = chatMessages.querySelector('.welcome-message');
  if (welcomeMsg) {
    welcomeMsg.scrollIntoView({ behavior: 'smooth' });
  } else {
    // Recreate welcome message
    const helpDiv = document.createElement('div');
    helpDiv.className = 'welcome-message';
    helpDiv.innerHTML = `
      <i class="fas fa-info-circle"></i>
      <h2>How to Use Your Student Learning Assistant</h2>
      <p>Upload PDFs (textbooks, notes, research papers) using the admin panel, then ask me questions about the content. I'll explain concepts in simple language and tell you exactly which page the information comes from.</p>
      <div class="example-questions" id="helpExamples"></div>
    `;
    chatMessages.insertBefore(helpDiv, chatMessages.firstChild);
    loadExamples();
    helpDiv.scrollIntoView({ behavior: 'smooth' });
  }
}

// File Upload Functions
function showNotification(message, type = 'success') {
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  
  const icon = type === 'success' ? 'fas fa-check-circle' : 
               type === 'error' ? 'fas fa-exclamation-circle' : 
               'fas fa-exclamation-triangle';
  
  notification.innerHTML = `
    <i class="${icon}"></i>
    <div>${message}</div>
  `;
  
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.remove();
  }, 5000);
}

function showUploadProgress(filename) {
  const overlay = document.createElement('div');
  overlay.className = 'upload-overlay';
  
  const progress = document.createElement('div');
  progress.className = 'upload-progress';
  progress.innerHTML = `
    <h3>Uploading Study Material</h3>
    <p>${filename}</p>
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <p id="progressText">Processing...</p>
  `;
  
  document.body.appendChild(overlay);
  document.body.appendChild(progress);
  
  return { overlay, progress };
}

function hideUploadProgress(elements) {
  if (elements.overlay) elements.overlay.remove();
  if (elements.progress) elements.progress.remove();
}

async function uploadFile(file) {
  const progressElements = showUploadProgress(file.name);
  const progressFill = document.getElementById('progressFill');
  const progressText = document.getElementById('progressText');
  
  try {
    // Validate file
    if (!file.name.toLowerCase().endsWith('.pdf')) {
      throw new Error('Only PDF files are supported');
    }
    
    if (file.size > 10 * 1024 * 1024) { // 10MB limit
      throw new Error('File size must be less than 10MB');
    }
    
    // Create form data
    const formData = new FormData();
    formData.append('file', file);
    
    // Simulate progress
    let progress = 0;
    const progressInterval = setInterval(() => {
      progress += Math.random() * 30;
      if (progress > 90) progress = 90;
      progressFill.style.width = progress + '%';
    }, 200);
    
    // Upload file
    const response = await fetch('/student/upload', {
      method: 'POST',
      body: formData
    });
    
    clearInterval(progressInterval);
    progressFill.style.width = '100%';
    progressText.textContent = 'Processing complete!';
    
    const result = await response.json();
    
    setTimeout(() => {
      hideUploadProgress(progressElements);
      
      if (response.ok) {
        showNotification(`Successfully uploaded "${file.name}"! Added ${result.chunks_added} study chunks.`, 'success');
        
        // Add system message to chat
        addMessage(`üìö Study material uploaded: "${file.name}" (${result.pages_processed} pages, ${result.chunks_added} chunks)`, false);
        
        // Refresh system info
        loadSystemInfo();
      } else {
        throw new Error(result.error || 'Upload failed');
      }
    }, 1000);
    
  } catch (error) {
    hideUploadProgress(progressElements);
    showNotification(`Upload failed: ${error.message}`, 'error');
  }
}

function handleFileSelect() {
  const files = fileInput.files;
  if (files.length === 0) return;
  
  // Upload files one by one
  Array.from(files).forEach(file => {
    uploadFile(file);
  });
  
  // Clear file input
  fileInput.value = '';
}

// Upload button click handler
uploadBtn.addEventListener('click', () => {
  fileInput.click();
});

// File input change handler
fileInput.addEventListener('change', handleFileSelect);

// PDF Management Functions
async function loadPdfList() {
  try {
    const response = await fetch('/student/uploads');
    const files = await response.json();
    
    if (files.length === 0) {
      pdfList.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-file-pdf"></i>
          <h3>No study materials uploaded yet</h3>
          <p>Upload your first PDF to get started!</p>
        </div>
      `;
      return;
    }
    
    let html = '';
    files.forEach(file => {
      const uploadDate = new Date(file.uploaded_at).toLocaleDateString();
      const statusIcon = file.status === 'ready' ? 'fas fa-check-circle' : 'fas fa-exclamation-triangle';
      const statusColor = file.status === 'ready' ? 'var(--success)' : 'var(--warning)';
      
      html += `
        <div class="pdf-item" data-filename="${file.filename}">
          <div class="pdf-info">
            <div class="pdf-name">
              <i class="fas fa-file-pdf"></i>
              ${file.original_filename}
            </div>
            <div class="pdf-details">
              <span><i class="${statusIcon}" style="color: ${statusColor}"></i> ${file.status}</span>
              <span><i class="fas fa-file-alt"></i> ${file.pages} pages</span>
              <span><i class="fas fa-puzzle-piece"></i> ${file.chunks} chunks</span>
              <span><i class="fas fa-weight-hanging"></i> ${file.file_size_mb} MB</span>
              <span><i class="fas fa-calendar"></i> ${uploadDate}</span>
            </div>
          </div>
          <div class="pdf-actions">
            <button class="delete-btn" onclick="confirmDeletePdf('${file.filename}', '${file.original_filename}')" title="Delete this PDF">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      `;
    });
    
    pdfList.innerHTML = html;
    
  } catch (error) {
    pdfList.innerHTML = `
      <div class="empty-state">
        <i class="fas fa-exclamation-triangle"></i>
        <h3>Error loading files</h3>
        <p>Please try again later</p>
      </div>
    `;
    console.error('Failed to load PDF list:', error);
  }
}

function showPdfManager() {
  pdfManagement.style.display = 'block';
  uploadArea.style.display = 'none';
  loadPdfList();
}

function hidePdfManager() {
  pdfManagement.style.display = 'none';
  uploadArea.style.display = 'block';
}

function confirmDeletePdf(filename, originalName) {
  showConfirmDialog(
    'Delete Study Material',
    `Are you sure you want to delete "${originalName}"?\\n\\nThis will permanently remove the PDF and all its content from your knowledge base. You won't be able to ask questions about this material anymore.`,
    'Delete',
    () => deletePdf(filename, originalName)
  );
}

async function deletePdf(filename, originalName) {
  try {
    showNotification(`Deleting "${originalName}"...`, 'warning');
    
    const response = await fetch(`/student/delete/${encodeURIComponent(filename)}`, {
      method: 'DELETE'
    });
    
    const result = await response.json();
    
    if (response.ok) {
      showNotification(`Successfully deleted "${originalName}" and removed ${result.chunks_removed} chunks.`, 'success');
      
      // Remove from UI immediately
      const pdfItem = document.querySelector(`[data-filename="${filename}"]`);
      if (pdfItem) {
        pdfItem.style.animation = 'slideOut 0.3s ease-out';
        setTimeout(() => {
          pdfItem.remove();
          // Reload list to check if empty
          loadPdfList();
        }, 300);
      }
      
      // Add system message to chat
      addMessage(`üóëÔ∏è Deleted study material: "${originalName}" (${result.chunks_removed} chunks removed)`, false);
      
      // Refresh system info
      loadSystemInfo();
      
    } else {
      throw new Error(result.error || 'Delete failed');
    }
    
  } catch (error) {
    showNotification(`Failed to delete "${originalName}": ${error.message}`, 'error');
  }
}

function showConfirmDialog(title, message, confirmText, onConfirm) {
  const overlay = document.createElement('div');
  overlay.className = 'confirm-overlay';
  
  const dialog = document.createElement('div');
  dialog.className = 'confirm-dialog';
  dialog.innerHTML = `
    <h3><i class="fas fa-exclamation-triangle" style="color: var(--warning)"></i> ${title}</h3>
    <p>${message}</p>
    <div class="confirm-actions">
      <button class="confirm-btn secondary" onclick="this.closest('.confirm-overlay').remove()">Cancel</button>
      <button class="confirm-btn danger" onclick="this.closest('.confirm-overlay').remove(); (${onConfirm.toString()})()">${confirmText}</button>
    </div>
  `;
  
  overlay.appendChild(dialog);
  document.body.appendChild(overlay);
  
  // Close on overlay click
  overlay.addEventListener('click', (e) => {
    if (e.target === overlay) {
      overlay.remove();
    }
  });
}

// Enhanced Upload Area Functions
function setupUploadArea() {
  // Click to upload
  uploadArea.addEventListener('click', () => {
    fileInput.click();
  });
  
  // Drag and drop
  uploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadArea.classList.add('dragover');
  });
  
  uploadArea.addEventListener('dragleave', (e) => {
    e.preventDefault();
    uploadArea.classList.remove('dragover');
  });
  
  uploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadArea.classList.remove('dragover');
    
    const files = Array.from(e.dataTransfer.files).filter(file => 
      file.name.toLowerCase().endsWith('.pdf')
    );
    
    if (files.length === 0) {
      showNotification('Please drop PDF files only', 'warning');
      return;
    }
    
    files.forEach(file => uploadFile(file));
  });
}

// Event Listeners
manageBtn.addEventListener('click', () => {
  if (pdfManagement.style.display === 'none' || !pdfManagement.style.display) {
    showPdfManager();
  } else {
    hidePdfManager();
  }
});

closePdfManager.addEventListener('click', hidePdfManager);

// Upload button click handler
uploadBtn.addEventListener('click', () => {
  fileInput.click();
});

// File input change handler
fileInput.addEventListener('change', handleFileSelect);

// Drag and drop support (legacy - now handled by upload area)
chatMessages.addEventListener('dragover', (e) => {
  e.preventDefault();
  chatMessages.style.background = 'rgba(37, 99, 235, 0.05)';
});

chatMessages.addEventListener('dragleave', (e) => {
  e.preventDefault();
  chatMessages.style.background = '';
});

chatMessages.addEventListener('drop', (e) => {
  e.preventDefault();
  chatMessages.style.background = '';
  
  const files = Array.from(e.dataTransfer.files).filter(file => 
    file.name.toLowerCase().endsWith('.pdf')
  );
  
  if (files.length === 0) {
    showNotification('Please drop PDF files only', 'warning');
    return;
  }
  
  files.forEach(file => uploadFile(file));
});
function toggleDark() {
  document.body.classList.toggle("dark");
  const isDark = document.body.classList.contains("dark");
  localStorage.setItem("theme", isDark ? "dark" : "light");
  
  const icon = document.querySelector(".header-controls .btn-icon:nth-child(3) i");
  icon.className = isDark ? "fas fa-sun" : "fas fa-moon";
}

// Load saved theme
if (localStorage.getItem("theme") === "dark") {
  document.body.classList.add("dark");
  document.querySelector(".header-controls .btn-icon:nth-child(3) i").className = "fas fa-sun";
}

// Clear chat with confirmation
function clearChat() {
  if (messageCounter > 0) {
    if (!confirm("Are you sure you want to clear the conversation?")) {
      return;
    }
  }
  
  chatMessages.innerHTML = `
    <div class="welcome-message">
      <i class="fas fa-book-open"></i>
      <h2>Welcome to Your Student Learning Assistant</h2>
      <p>I'm here to help you understand your study materials! Upload PDFs (textbooks, notes, research papers) and ask me questions. I'll explain concepts in simple language and show you exactly where the information comes from.</p>
      <div class="example-questions" id="exampleQuestions">
        <h3>üí° Try asking:</h3>
      </div>
    </div>
  `;
  messageCounter = 0;
  updateMessageCount();
  loadExamples();
}

// Auto-resize textarea
messageInput.addEventListener('input', function() {
  this.style.height = 'auto';
  this.style.height = Math.min(this.scrollHeight, 120) + 'px';
});

// Add message to chat
function addMessage(text, isUser = false, responseTime = null) {
  const welcomeMsg = chatMessages.querySelector('.welcome-message');
  if (welcomeMsg) {
    welcomeMsg.remove();
  }

  const messageDiv = document.createElement("div");
  messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
  
  const messageText = document.createElement("div");
  messageText.textContent = text;
  messageDiv.appendChild(messageText);

  if (responseTime !== null) {
    const timeDiv = document.createElement("div");
    timeDiv.className = "message-time";
    timeDiv.innerHTML = `<i class="fas fa-clock"></i> ${(responseTime/1000).toFixed(2)}s`;
    messageDiv.appendChild(timeDiv);
  }

  chatMessages.appendChild(messageDiv);
  chatMessages.scrollTop = chatMessages.scrollHeight;
  
  messageCounter++;
  updateMessageCount();
}

// Show/hide typing indicator
function showTyping() {
  typingIndicator.style.display = 'flex';
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

function hideTyping() {
  typingIndicator.style.display = 'none';
}

// Update message count
function updateMessageCount() {
  messageCount.textContent = `${messageCounter} message${messageCounter !== 1 ? 's' : ''}`;
}

// Send message
async function sendMessage() {
  const message = messageInput.value.trim();
  if (!message) return;

  // Disable input
  messageInput.disabled = true;
  sendBtn.disabled = true;
  
  // Add user message
  addMessage(message, true);
  messageInput.value = "";
  messageInput.style.height = 'auto';

  // Show typing indicator
  showTyping();

  const startTime = performance.now();
  
  try {
    const response = await fetch("/query", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ query: message })
    });
    
    const data = await response.json();
    const endTime = performance.now();
    const responseTime = Math.round(endTime - startTime);

    hideTyping();
    addMessage(data.response || "I couldn't process that request.", false, responseTime);
    
  } catch (error) {
    hideTyping();
    addMessage("Sorry, I'm having trouble connecting. Please try again or contact support if the issue persists.", false);
  } finally {
    // Re-enable input
    messageInput.disabled = false;
    sendBtn.disabled = false;
    messageInput.focus();
  }
}

// Event listeners
sendBtn.addEventListener('click', sendMessage);

messageInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});

// Initialize
window.addEventListener('load', () => {
  messageInput.focus();
  loadSystemInfo();
  loadExamples();
  setupUploadArea();
});
</script>

</body>
</html>
